---
layout: post
title: 以用户为中心的性能指标
authors:
  - philipwalton
date: '2019-11-08'
description: |2

  以用户为中心的性能指标是理解和

  以有益于实际的方式改善您网站的体验

  用户。
tags:
  - performance
  - metrics
---

我们都听说过性能是多么重要。但是当我们谈论性能——以及让网站“快速”时——我们具体指的是什么？

事实是性能是相对的：

- 一个站点对一个用户来说可能很快（在具有强大设备的快速网络上），但对另一个用户来说可能很慢（在带有低端设备的慢速网络上）。
- 两个站点可能在完全相同的时间内完成加载，但一个*似乎*加载速度更快（如果它逐渐加载内容而不是等到最后才显示任何内容）。
- 一个网站可能*看起来*加载很快，但随后对用户交互的响应很慢（或根本不响应）。

因此，在谈论绩效时，重要的是要准确，并根据可以定量衡量的客观标准来指称绩效。这些标准称为*指标*。

但仅仅因为指标基于客观标准并且可以定量测量，并不一定意味着这些测量是有用的。

## 定义指标

从历史上看，Web 性能是通过<code>[load](https://developer.mozilla.org/en-US/docs/Web/API/Window/load_event)</code>事件来衡量的。然而，尽管<code>load</code>是页面生命周期中定义明确的时刻，但该时刻并不一定与用户关心的任何事情相对应。

例如，服务器可以用一个最小的页面来响应，该页面立即“加载”，然后推迟获取内容并在页面上显示任何内容，直到`load`事件触发后几秒钟。虽然这样的页面在技术上可能具有较快的加载时间，但该时间与用户实际体验页面加载的方式不符。

在过去几年中，Chrome 团队的成员与[W3C 网络性能工作组](https://www.w3.org/webperf/)合作，一直致力于标准化一组新的 API 和指标，以更准确地衡量用户如何体验网页的性能。

为帮助确保指标与用户相关，我们围绕几个关键问题构建它们：

<table id="questions">
  <tr>
    <td><strong>它正在发生吗？</strong></td>
    <td>导航是否成功启动？服务器有反应吗？</td>
  </tr>
  <tr>
    <td><strong>有用吗？</strong></td>
    <td>是否呈现了足够多的内容让用户可以参与其中？</td>
  </tr>
  <tr>
    <td><strong>可以用吗？</strong></td>
    <td>用户是否可以与页面交互，或者页面是否繁忙？</td>
  </tr>
  <tr>
    <td><strong>令人愉快吗？</strong></td>
    <td>交互是否流畅自然，没有延迟和卡顿？</td>
  </tr>
</table>

## 如何衡量指标

性能指标通常通过以下两种方式之一来衡量：

- **在实验室中：**使用工具在一致、受控的环境中模拟页面加载
- **在现场**：真实用户实际加载页面并与页面交互

这些选项中的任何一个都不一定比另一个更好或更差——事实上，您通常希望同时使用这两个选项来确保良好的性能。

### 在实验室

在开发新功能时，在实验室中测试性能至关重要。在功能在生产中发布之前，不可能在真实用户身上测量它们的性能特征，因此在功能发布之前在实验室中测试它们是防止性能回归的最佳方法。

### 在该领域

另一方面，虽然实验室测试是性能的合理代表，但它不一定反映所有用户在野外体验您的网站的情况。

根据用户的设备功能及其网络状况，站点的性能可能会有很大差异。它还可以根据用户是否（或如何）与页面交互而有所不同。

此外，页面加载可能不是确定性的。例如，加载个性化内容或广告的网站可能会体验到因用户而异的性能特征。实验室测试不会捕捉到这些差异。

真正了解您的网站如何为您的用户执行的唯一方法是在这些用户加载和与之交互时实际衡量其性能。这种类型的测量通常称为[真实用户监控](https://en.wikipedia.org/wiki/Real_user_monitoring)— 或简称为 RUM。

## 指标类型

还有几种其他类型的指标与用户如何感知性能相关。

- **感知加载速度：**页面加载并将其所有视觉元素呈现到屏幕上的速度。
- **加载响应：**页面加载和执行任何所需 JavaScript 代码的速度，以便组件快速响应用户交互
- **运行时响应能力：**页面加载后，页面对用户交互的响应速度有多快。
- **视觉稳定性：**页面上的元素是否以用户不期望的方式移动并可能干扰他们的交互？
- **平滑度：**过渡和动画是否以一致的帧速率呈现并从一种状态流畅地流动到下一种状态？

鉴于上述所有类型的性能指标，希望没有一个指标足以捕获页面的所有性能特征。

## 衡量的重要指标

- **[首次内容绘制 (FCP)](/fcp/) ：**测量从页面开始加载到页面内容的任何部分在屏幕上呈现的时间。 *（[实验室](#in-the-lab)，[现场](#in-the-field)）*
- **[最大内容绘制 (LCP)](/lcp/) ：**测量从页面开始加载到最大文本块或图像元素在屏幕上呈现的时间。 *（[实验室](#in-the-lab)，[现场](#in-the-field)）*
- **[首次输入延迟 (FID)](/fid/) ：**测量从用户第一次与您的网站交互（即当他们单击链接、点击按钮或使用自定义的、由 JavaScript 驱动的控件）到浏览器实际能够运行的时间来回应这种互动。 *([字段](#in-the-field))*
- **[交互时间 (TTI)](/tti/) ：**测量从页面开始加载到可视化呈现、其初始脚本（如果有）已加载并且能够可靠地快速响应用户输入的时间。 *（[实验室](#in-the-lab)）*
- **[总阻塞时间 (TBT)](/tbt/) ：**测量 FCP 和 TTI 之间主线程被阻塞足够长的时间以防止输入响应的总时间。 *（[实验室](#in-the-lab)）*
- **[累积布局偏移 (CLS)](/cls/) ：** [测量在页面开始加载和其生命周期状态](https://developers.google.com/web/updates/2018/07/page-lifecycle-api)变为隐藏之间发生的所有意外布局偏移的累积分数。 *（[实验室](#in-the-lab)，[现场](#in-the-field)）*

虽然此列表包括衡量与用户相关的性能的许多不同方面的指标，但它并不包括所有内容（例如，当前未涵盖运行时响应性和平滑度）。

在某些情况下，将引入新指标来覆盖缺失的区域，但在其他情况下，最佳指标是专门为您的站点量身定制的指标。

## 自定义指标

上面列出的性能指标有助于大致了解 Web 上大多数站点的性能特征。它们也有利于为网站提供一组通用的指标，以将其性能与竞争对手进行比较。

但是，有时特定站点在某些方面是独一无二的，需要额外的指标来捕获完整的性能图片。例如，LCP 指标旨在衡量页面的主要内容何时完成加载，但在某些情况下，最大的元素不是页面主要内容的一部分，因此 LCP 可能不相关。

为了解决这种情况，Web 性能工作组还标准化了较低级别的 API，这些 API 可用于实现您自己的自定义指标：

- [用户计时 API](https://w3c.github.io/user-timing/)
- [长任务 API](https://w3c.github.io/longtasks/)
- [元素计时 API](https://wicg.github.io/element-timing/)
- [导航计时API](https://w3c.github.io/navigation-timing/)
- [资源计时 API](https://w3c.github.io/resource-timing/)
- [服务器计时](https://w3c.github.io/server-timing/)

请参阅[自定义指标](/custom-metrics/)指南，了解如何使用这些 API 来衡量特定于您站点的性能特征。
