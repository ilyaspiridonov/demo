---
layout: post
title: ユーザー中心のパフォーマンスメトリクス
authors:
  - philipwalton
date: '2019-11-08'
description: |2

  ユーザー中心のパフォーマンスメトリクスは、

  本当の利益をもたらす方法であなたのサイトの経験を改善する

  ユーザー。
tags:
  - performance
  - metrics
---

パフォーマンスがいかに重要かを聞いたことがあります。しかし、パフォーマンスについて、そしてWebサイトを「高速」にすることについて話すとき、具体的にはどういう意味ですか？

真実は、パフォーマンスは相対的です。

- サイトは、あるユーザーにとっては高速（強力なデバイスを備えた高速ネットワーク上）であるが、別のユーザーにとっては低速（ローエンドデバイスを備えた低速ネットワーク上）である可能性があります。
- 2つのサイトがまったく同じ時間で読み込みを完了する場合がありますが、一方のサイトは*読み込みが速いように見える*場合があります（コンテンツが最後まで表示されるのを待つのではなく、徐々に読み込まれる場合）。
- サイトの*読み込みは速いように見え*ても、ユーザーの操作に対する応答が遅い（またはまったく応答しない）場合があります。

したがって、パフォーマンスについて話すときは、正確であり、定量的に測定できる客観的な基準の観点からパフォーマンスを参照することが重要です。これらの基準は*メトリクスと*呼ばれます。

しかし、メトリックが客観的な基準に基づいており、定量的に測定できるからといって、必ずしもそれらの測定が有用であることを意味するわけではありません。

## メトリックの定義

これまで、Webパフォーマンスは<code>[load](https://developer.mozilla.org/en-US/docs/Web/API/Window/load_event)</code>イベントで測定されてきました。ただし、 <code>load</code>はページのライフサイクルで明確に定義された瞬間ですが、その瞬間は必ずしもユーザーが気にかけているものと一致するとは限りません。

たとえば、サーバーは、すぐに「ロード」する最小限のページで応答できますが、 `load`イベントが発生してから数秒後まで、コンテンツのフェッチとページへの表示を延期します。このようなページの読み込み時間は技術的には速いかもしれませんが、その時間はユーザーが実際にページの読み込みをどのように体験するかに対応していません。

過去数年間、Chromeチームのメンバーは、 [W3C Webパフォーマンスワーキンググループ](https://www.w3.org/webperf/)と協力して、ユーザーがWebページのパフォーマンスをどのように体験するかをより正確に測定する一連の新しいAPIとメトリックの標準化に取り組んできました。

指標がユーザーに関連していることを確認するために、いくつかの重要な質問を中心に指標を組み立てます。

<table id="questions">
  <tr>
    <td><strong>それは起こっていますか？</strong></td>
    <td>ナビゲーションは正常に開始されましたか？サーバーは応答しましたか？</td>
  </tr>
  <tr>
    <td><strong>役に立ちますか？</strong></td>
    <td>ユーザーが利用できる十分なコンテンツがレンダリングされていますか？</td>
  </tr>
  <tr>
    <td><strong>使えますか？</strong></td>
    <td>ユーザーはページを操作できますか、それともビジーですか？</td>
  </tr>
  <tr>
    <td><strong>楽しいですか？</strong></td>
    <td>相互作用はスムーズで自然で、ラグやジャンクがありませんか？</td>
  </tr>
</table>

## メトリックの測定方法

パフォーマンスメトリックは通常、次の2つの方法のいずれかで測定されます。

- **ラボで：**ツールを使用して、一貫性のある制御された環境でページの読み込みをシミュレートします
- **フィールドで**：実際にページを読み込んで操作する実際のユーザー

これらのオプションのどちらも、必ずしも他のオプションよりも優れている、または劣っているわけではありません。実際、通常は両方を使用して、良好なパフォーマンスを確保する必要があります。

### 研究所で

新しい機能を開発するときは、ラボでパフォーマンスをテストすることが不可欠です。機能が本番環境でリリースされる前に、実際のユーザーでそれらのパフォーマンス特性を測定することは不可能であるため、機能がリリースされる前にラボでそれらをテストすることが、パフォーマンスの低下を防ぐための最良の方法です。

### 現場で

一方、ラボでのテストはパフォーマンスの妥当なプロキシですが、すべてのユーザーが実際にサイトをどのように体験しているかを必ずしも反映しているわけではありません。

サイトのパフォーマンスは、ユーザーのデバイス機能とネットワークの状態によって大幅に異なる可能性があります。また、ユーザーがページを操作しているかどうか（またはどのように操作しているか）によっても異なります。

さらに、ページの読み込みは決定論的ではない場合があります。たとえば、パーソナライズされたコンテンツや広告を読み込むサイトでは、ユーザーごとにパフォーマンス特性が大きく異なる場合があります。ラボテストでは、これらの違いを把握できません。

サイトがユーザーに対してどのように機能するかを真に知る唯一の方法は、ユーザーがサイトを読み込んで操作しているときに、実際にそのパフォーマンスを測定することです。このタイプの測定は、一般に[Real User Monitoring（](https://en.wikipedia.org/wiki/Real_user_monitoring)略してRUM）と呼ばれます。

## 指標の種類

ユーザーがパフォーマンスをどのように認識するかに関連する他のいくつかのタイプのメトリックがあります。

- **知覚される読み込み速度：**ページがすべての視覚要素を読み込みて画面にレンダリングできる速度。
- **ロードの応答性：**コンポーネントがユーザーの操作に迅速に応答するために、ページが必要なJavaScriptコードをロードして実行できる速度
- **実行時の応答性：**ページの読み込み後、ページがユーザーの操作にどれだけ迅速に応答できるか。
- **視覚的な安定性：**ページ上の要素は、ユーザーが予期しない方法でシフトし、相互作用を妨げる可能性がありますか？
- **滑らかさ：**トランジションとアニメーションは一定のフレームレートでレンダリングされ、ある状態から次の状態へと流動的に流れますか？

上記のすべてのタイプのパフォーマンスメトリックを考えると、ページのすべてのパフォーマンス特性をキャプチャするのに十分な単一のメトリックがないことは明らかです。

## 測定する重要な指標

- **[First Contentful Paint（FCP）](/fcp/) ：**ページの読み込みが開始されてから、ページのコンテンツの一部が画面に表示されるまでの時間を測定します。 *（[ラボ](#in-the-lab)、[フィールド](#in-the-field)）*
- **[最大コンテンツペイント（LCP）](/lcp/) ：**ページの読み込みが開始されてから、最大のテキストブロックまたは画像要素が画面にレンダリングされるまでの時間を測定します。 *（[ラボ](#in-the-lab)、[フィールド](#in-the-field)）*
- **[最初の入力遅延（FID）](/fid/) ：**ユーザーが最初にサイトを操作してから（つまり、ユーザーがリンクをクリックしたり、ボタンをタップしたり、カスタムのJavaScriptベースのコントロールを使用したりしてから）、ブラウザーが実際に使用できるようになるまでの時間を測定します。その相互作用に応答します。 *（[フィールド](#in-the-field)）*
- **[Time to Interactive（TTI）](/tti/) ：**ページの読み込みが開始されてから視覚的にレンダリングされ、最初のスクリプト（存在する場合）が読み込まれるまでの時間を測定し、ユーザー入力にすばやく確実に応答することができます。 *（[ラボ](#in-the-lab)）*
- **[合計ブロッキング時間（TBT）](/tbt/) ：** FCPとTTIの間で、入力の応答性を妨げるのに十分な時間メインスレッドがブロックされた合計時間を測定します。 *（[ラボ](#in-the-lab)）*
- **[累積レイアウトシフト（CLS）](/cls/) ：** [ページの読み込みが開始されてからライフサイクル状態](https://developers.google.com/web/updates/2018/07/page-lifecycle-api)が非表示に変わるまでの間に発生するすべての予期しないレイアウトシフトの累積スコアを測定します。 *（[ラボ](#in-the-lab)、[フィールド](#in-the-field)）*

このリストには、ユーザーに関連するパフォーマンスのさまざまな側面の多くを測定するメトリックが含まれていますが、すべてが含まれているわけではありません（たとえば、実行時の応答性とスムーズさは現在カバーされていません）。

不足している領域をカバーするために新しいメトリックが導入される場合もありますが、サイトに合わせて特別に調整されたメトリックが最適な場合もあります。

## カスタムメトリック

上記のパフォーマンスメトリックは、Web上のほとんどのサイトのパフォーマンス特性を一般的に理解するのに役立ちます。また、サイトのパフォーマンスを競合他社と比較するための共通のメトリックセットを用意するのにも適しています。

ただし、特定のサイトが何らかの方法で一意であり、パフォーマンス全体の全体像を把握するために追加のメトリックが必要になる場合があります。たとえば、LCPメトリックは、ページのメインコンテンツの読み込みが完了したことを測定することを目的としていますが、最大の要素がページのメインコンテンツの一部ではないため、LCPが関連しない場合があります。

このような場合に対処するために、Web Performance Working Groupは、独自のカスタムメトリックの実装に役立つ可能性のある低レベルのAPIも標準化しています。

- [ユーザータイミングAPI](https://w3c.github.io/user-timing/)
- [ロングタスクAPI](https://w3c.github.io/longtasks/)
- [要素タイミングAPI](https://wicg.github.io/element-timing/)
- [ナビゲーションタイミングAPI](https://w3c.github.io/navigation-timing/)
- [リソースタイミングAPI](https://w3c.github.io/resource-timing/)
- [サーバーのタイミング](https://w3c.github.io/server-timing/)

これらのAPIを使用してサイトに固有のパフォーマンス特性を測定する方法については[、カスタムメトリック](/custom-metrics/)に関するガイドを参照してください。
